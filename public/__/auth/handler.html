<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Authentication Redirect Handler</title>
    <script>
      (function () {
        // This handler page follows Firebase Auth best practices for handling redirects
        // It will immediately redirect back to your app with the auth result

        // Parse the current URL query parameters
        const params = new URLSearchParams(window.location.search);

        // Get the return URL from query or use root as fallback
        let returnUrl = params.get("return_url") || "/";

        // Optional: Add any additional parameters from the auth response
        // This allows you to pass auth state through the redirect
        if (params.has("code") || params.has("state") || params.has("error")) {
          // Append relevant auth params to your return URL
          const authParams = new URLSearchParams();

          if (params.has("code")) authParams.set("code", params.get("code"));
          if (params.has("state")) authParams.set("state", params.get("state"));
          if (params.has("error")) authParams.set("error", params.get("error"));

          // Add auth params to return URL
          if (returnUrl.includes("?")) {
            returnUrl += "&" + authParams.toString();
          } else {
            returnUrl += "?" + authParams.toString();
          }
        }

        // Set a flag to indicate this is a redirect return
        localStorage.setItem("firebase_auth_redirect_in_progress", "true");

        // Log the redirect for debugging
        console.log("Auth handler redirecting to:", returnUrl);

        // Redirect back to the app
        window.location.replace(returnUrl);
      })();
    </script>
  </head>
  <body>
    <p>Redirecting you back to the application...</p>
  </body>
</html>
